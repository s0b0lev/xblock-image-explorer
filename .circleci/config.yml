version: 2
jobs:
  test-2.7: &test-template
    docker:
      - image: circleci/python:2.7.16-browsers
    steps:
      - checkout
      - run:
          name: Install Dependencies
          command: |
            mkdir -p ./venv
            virtualenv ./venv
            . venv/bin/activate
            pip install tox
      - run:
          name: Run unit tests
          command: |
            . venv/bin/activate
            tox -e unit
          when: always
      - run:
          name: Run integration tests
          command: |
            . venv/bin/activate
            tox -e integration
          when: always
  test-3.5:
    <<: *test-template
    docker:
        - image: circleci/python:3.5-browsers
  quality:
    docker:
      - image: circleci/python:2.7.16
    steps:
      - checkout
      - run:
          name: Install Dependencies
          command: |
            mkdir -p ./venv
            virtualenv ./venv
            . venv/bin/activate
            pip install tox pylint
      - run:
          name: Run quality tests
          command: |
            . venv/bin/activate
            tox -e quality
          when: always
      - run:
          name: Run python3 quality tests
          command: |
            . venv/bin/activate
            tox -e python3-quality
          when: always
workflows:
  version: 2
  build:
    jobs:
      - test-2.7
      - test-3.5
      - quality
